<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫–µ—Ä: –†–æ—Å—Å–∏—è vs –£–∫—Ä–∞–∏–Ω–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º CDN –±–µ–∑ –º–æ–¥—É–ª–µ–π -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 10px; text-align: center; }
        button { padding: 12px 20px; margin: 10px; font-size: 16px; background: #0088cc; color: white; border: none; border-radius: 8px; }
        .scoreboard { margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 8px; }
    </style>
</head>
<body>
    <div id="app">
        <div v-if="!userCountry" class="country-select">
            <h1>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</h1>
            <button @click="selectCountry('Russia')">üá∑üá∫ –†–æ—Å—Å–∏—è</button>
            <button @click="selectCountry('Ukraine')">üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞</button>
        </div>
        
        <div v-else class="clicker">
            <h1>–í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞: {{ userCountry }}</h1>
            <button @click="addClick">–ö–õ–ò–ö–ù–£–¢–¨ ({{ userClicks }})</button>
            
            <h2>–û–±—â–∏–π —Å—á—ë—Ç:</h2>
            <div class="scoreboard">
                <div>üá∑üá∫ –†–æ—Å—Å–∏—è: {{ countryScores.Russia || 0 }}</div>
                <div>üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞: {{ countryScores.Ukraine || 0 }}</div>
            </div>
        </div>
    </div>

    <!-- Vue 3 (production –≤–µ—Ä—Å–∏—è) -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.47/dist/vue.global.prod.js"></script>
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase -->
    <script>
        // –í–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Firebase Console
        const firebaseConfig = {
          apiKey: "AIzaSyCM_mQULdndLnXTXmjvWMM1u1jY3619fXc",
          authDomain: "my-miniapp-e609e.firebaseapp.com",
          databaseURL: "https://my-minlapp-ed99e-default-rctb.europe-west1.firebasedatabase.app",
          projectId: "my-miniapp-e609e",
          storageBucket: "my-miniapp-e609e.firebasestorage.app",
          messagingSenderId: "791995427739",
          appId: "1:791995427739:web:cbe22b29ddfea2b4a70f3e",
          measurementId: "G-R1K9ZJD59Y"
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        console.log("Firebase initialized!");
    </script>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const tg = window.Telegram.WebApp;
                const userCountry = ref(null);
                const userClicks = ref(0);
                const countryScores = ref({ Russia: 0, Ukraine: 0 });

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                onMounted(() => {
                    console.log("–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Firebase...");
                    firebase.database().ref('countryScores').on('value', (snapshot) => {
                        const data = snapshot.val() || { Russia: 0, Ukraine: 0 };
                        countryScores.value = data;
                        console.log("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:", data);
                    });
                });

                // –í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã
                const selectCountry = (country) => {
                    userCountry.value = country;
                    tg.expand();
                    console.log("–í—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∞:", country);
                };

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
                const addClick = () => {
                    if (!userCountry.value) return;

                    userClicks.value++;
                    const updates = {};
                    updates[`countryScores/${userCountry.value}`] = (countryScores.value[userCountry.value] || 0) + 1;
                    
                    firebase.database().ref().update(updates)
                        .then(() => console.log("–°—á—ë—Ç –æ–±–Ω–æ–≤–ª—ë–Ω!"))
                        .catch(error => console.error("–û—à–∏–±–∫–∞:", error));
                };

                return { userCountry, userClicks, countryScores, selectCountry, addClick };
            }
        }).mount('#app');
    </script>
</body>
</html>