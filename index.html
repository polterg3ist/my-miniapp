<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кликер: Россия vs Украина</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: Arial, padding: 10px; text-align: center; }
        button { padding: 12px 20px; margin: 5px; background: #0088cc; color: white; border: none; border-radius: 5px; }
        .scoreboard { margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="app">
        <div v-if="!userCountry">
            <h1>Выберите страну</h1>
            <button @click="selectCountry('Russia')">🇷🇺 Россия</button>
            <button @click="selectCountry('Ukraine')">🇺🇦 Украина</button>
        </div>
        <div v-else>
            <h1>Вы играете за: {{ userCountry }}</h1>
            <button @click="addClick">КЛИК ({{ userClicks }})</button>
            <div class="scoreboard">
                <div>🇷🇺 Россия: {{ countryScores.Russia || 0 }}</div>
                <div>🇺🇦 Украина: {{ countryScores.Ukraine || 0 }}</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.47/dist/vue.global.prod.js"></script>

    <script>
        // Конфигурация (замените значениями из Firebase Console)
        const firebaseConfig = {
            apiKey: "AIzaSy...",
            authDomain: "my-miniapp-e609e.firebaseapp.com",
            databaseURL: "https://my-miniapp-e609e-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "my-miniapp-e609e",
            storageBucket: "my-miniapp-e609e.appspot.com",
            messagingSenderId: "123...",
            appId: "1:123...:web:abc..."
        };

        // Инициализация Firebase
        firebase.initializeApp(firebaseConfig);
        console.log("Firebase подключён к:", firebaseConfig.databaseURL);

        // Vue приложение
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const tg = window.Telegram.WebApp;
                const userCountry = ref(null);
                const userClicks = ref(0);
                const countryScores = ref({ Russia: 0, Ukraine: 0 });

                // Инициализация базы данных
                onMounted(() => {
                    firebase.database().ref('countryScores').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (!data) {
                            // Создаём структуру при первом запуске
                            firebase.database().ref('countryScores').set({
                                Russia: 0,
                                Ukraine: 0
                            });
                        } else {
                            countryScores.value = data;
                        }
                        console.log("Текущие scores:", data || { Russia: 0, Ukraine: 0 });
                    });
                });

                // Выбор страны
                const selectCountry = (country) => {
                    userCountry.value = country;
                    tg.expand();
                };

                // Обработка клика
                const addClick = () => {
                    if (!userCountry.value) return;

                    userClicks.value++;
                    firebase.database().ref('countryScores/' + userCountry.value)
                        .transaction((current) => (current || 0) + 1)
                        .then(() => console.log("Счёт обновлён"))
                        .catch(e => console.error("Ошибка:", e));
                };

                return { userCountry, userClicks, countryScores, selectCountry, addClick };
            }
        }).mount('#app');
    </script>
</body>
</html>