<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫–µ—Ä: –†–æ—Å—Å–∏—è vs –£–∫—Ä–∞–∏–Ω–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Firebase 8.10.0 (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { font-family: Arial, padding: 10px; text-align: center; }
        button { padding: 12px 20px; margin: 5px; background: #0088cc; color: white; border: none; border-radius: 5px; }
        .scoreboard { margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="app">
        <div v-if="!userCountry">
            <h1>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</h1>
            <button @click="selectCountry('Russia')">üá∑üá∫ –†–æ—Å—Å–∏—è</button>
            <button @click="selectCountry('Ukraine')">üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞</button>
        </div>
        <div v-else>
            <h1>–í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞: {{ userCountry }}</h1>
            <button @click="addClick">–ö–õ–ò–ö ({{ userClicks }})</button>
            <div class="scoreboard">
                <div>üá∑üá∫ –†–æ—Å—Å–∏—è: {{ scores.Russia || 0 }}</div>
                <div>üá∫üá¶ –£–∫—Ä–∞–∏–Ω–∞: {{ scores.Ukraine || 0 }}</div>
            </div>
        </div>
    </div>

    <!-- Vue 3 Production -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.47/dist/vue.global.prod.js"></script>

    <!-- Firebase –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ -->
    <script>
        // –ö–æ–Ω—Ñ–∏–≥ –∏–∑ Firebase Console ‚Üí Project settings
        const firebaseConfig = {
          apiKey: "AIzaSyCM_mQULdndLnXTXmjvWMM1u1jY3619fXc",
          authDomain: "my-miniapp-e609e.firebaseapp.com",
          projectId: "my-miniapp-e609e",
          databaseURL: "https://my-minlapp-e609e-default-rtdb.europe-west1.firebasedatabase.app",
          storageBucket: "my-miniapp-e609e.firebasestorage.app",
          messagingSenderId: "791995427739",
          appId: "1:791995427739:web:cbe22b29ddfea2b4a70f3e",
          measurementId: "G-R1K9ZJD59Y"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const app = firebase.initializeApp(firebaseConfig);
        console.log("Firebase connected to:", firebaseConfig.databaseURL);

        // Vue –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const tg = window.Telegram.WebApp;
                const userCountry = ref(null);
                const userClicks = ref(0);
                const scores = ref({ Russia: 0, Ukraine: 0 });

                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase
                onMounted(() => {
                    firebase.database().ref('scores').on('value', (snapshot) => {
                        const data = snapshot.val() || { Russia: 0, Ukraine: 0 };
                        scores.value = data;
                        console.log("–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:", data);
                    });
                });

                // –í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã
                const selectCountry = (country) => {
                    userCountry.value = country;
                    tg.expand();
                };

                // –ö–ª–∏–∫
                const addClick = () => {
                    if (!userCountry.value) return;

                    userClicks.value++;
                    firebase.database().ref('scores/' + userCountry.value)
                        .transaction((current) => (current || 0) + 1)
                        .catch(e => console.error("–û—à–∏–±–∫–∞:", e));
                };

                return { userCountry, userClicks, scores, selectCountry, addClick };
            }
        }).mount('#app');
    </script>
</body>
</html>